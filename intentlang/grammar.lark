// ============================
// ENTRY POINT
// ============================

start: rule+

// ============================
// RULES
// ============================

rule: "rule" STRING "{" when then "}"

when: "when" expr
then: "then" mutation+

// ============================
// EXPRESSIONS (READ-ONLY)
// ============================

?expr: expr "and" expr   -> and_expr
     | expr "or" expr    -> or_expr
     | comparison
     | function_call
     | "(" expr ")"

comparison: path COMP_OP value

function_call: NAME "(" [arguments] ")"

arguments: expr ("," expr)*

// ============================
// OPERATORS
// ============================

COMP_OP: "==" | "!=" | ">=" | "<=" | ">" | "<"

// ============================
// MUTATIONS (STATE CHANGES)
// ============================

mutation: path MUT_OP value


MUT_OP: "=" | "+=" | "-="

// ============================
// PRIMITIVES
// ============================

path: IDENT ("." IDENT)*

value: NUMBER
     | STRING
     | BOOLEAN

BOOLEAN: "true" | "false"

// ============================
// TOKENS
// ============================

IDENT: /[a-zA-Z_][a-zA-Z0-9_]*/

%import common.SIGNED_NUMBER -> NUMBER
%import common.ESCAPED_STRING -> STRING
%import common.WS
%ignore WS
