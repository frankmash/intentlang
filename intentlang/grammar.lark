// ============================
// ENTRY POINT
// ============================

start: rule+

// ============================
// RULES
// ============================

rule: "rule" STRING "{" when then "}"

when: "when" expr
then: "then" mutation+

// ============================
// EXPRESSIONS (READ-ONLY)
// ============================

?expr: or_expr

?or_expr: and_expr
        | or_expr "or" and_expr   -> or_expr

?and_expr: comparison
         | and_expr "and" comparison -> and_expr

comparison: operand COMP_OP operand

?operand: function_call
         | path
         | value
         | "(" expr ")"

function_call: IDENT "(" [arguments] ")"

arguments: expr ("," expr)*

// ============================
// OPERATORS
// ============================

COMP_OP: "==" | "!=" | ">=" | "<=" | ">" | "<"

// ============================
// MUTATIONS (STATE CHANGES)
// ============================

mutation: path MUT_OP value

MUT_OP: "=" | "+=" | "-="

// ============================
// PRIMITIVES
// ============================

path: IDENT ("." IDENT)*

value: NUMBER
     | STRING
     | BOOLEAN

BOOLEAN: "true" | "false"

// ============================
// TOKENS
// ============================

IDENT: /[a-zA-Z_][a-zA-Z0-9_]*/

%import common.SIGNED_NUMBER -> NUMBER
%import common.ESCAPED_STRING -> STRING
%import common.WS
%ignore WS
